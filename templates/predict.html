<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dự Đoán Số Phận</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Thêm CSS nếu cần */
    </style>
</head>
<body>
    <div class="container">
        <h1>Chọn Đặc Điểm Ngoại Hình</h1>

        <form id="physical-traits-form" method="POST">
            {% csrf_token %}
            <div class="traits-selection">
                <label for="traits">Chọn các đặc điểm ngoại hình:</label><br>
                {% for trait_key, trait_name in physical_traits.items %}
                    <input type="checkbox" id="{{ trait_key }}" name="selected_physical_traits[]" value="{{ trait_key }}">
                    <label for="{{ trait_key }}">{{ trait_name }}</label><br>
                {% endfor %}
            </div>

            <button type="submit" id="submit-button">Xem Kết Quả</button>
        </form>

        <div id="result-section" style="display:none;">
            <h2>Kết Luận</h2>
            <p id="destiny"></p>
            <p id="applied-rules"></p>
            <p id="advice"></p>
        </div>
    </div>

    <script>
    $(document).ready(function() {
        $('#physical-traits-form').on('submit', function(event) {
            event.preventDefault(); // Ngăn chặn reload trang khi submit

            var selectedTraits = $('input[name="selected_physical_traits[]"]:checked').map(function() {
                return this.value;
            }).get();

            $.ajax({
                url: "{% url 'predict' %}",
                method: "POST",
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'selected_physical_traits[]': selectedTraits
                },
                success: function(response) {
                    $('#destiny').text('Kết luận: ' + response.destiny);
                    $('#applied-rules').text('Quy tắc áp dụng: ' + response.rule_applied_2.join(', '));
                    $('#advice').text('Lời khuyên: ' + response.advice);

                    $('#result-section').show();
                },
                error: function() {
                    alert('Đã xảy ra lỗi. Vui lòng thử lại sau.');
                }
            });
        });
    });
    </script>
</body>
</html>